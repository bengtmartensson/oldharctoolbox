<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE macros PUBLIC "-//bengt-martensson.de//macros//en" "../dtds/macros.dtd">
<macros name="mymacs">
    <description>Convention:
watch-DEVICE: turn to DEVICE for audio and video,
listen-DEVICE: turn to DEVICE for audio, leaving video alone (as far as possible)
look-DEVICE: turn to DEVICE for video, leave audio alone as far as
possible.

In macro names, we prefer hyphens (-) over underscores (_).

Macros are uniquely identified by their name. The folder structure ist just
imposing some visually pleasing order for humans. In particular, macros do not
inherit private-ness from a containing folder.

Use generic names ("amp") when the macro is generic, specific names when the
function is specific.
    </description>
    <macros visibility="private" name="testmacros">
        <macro name="testdelay">
            <message>Starting...</message>
            <delay duration="10000"/>
            <message>..finished</message>
        </macro>
    </macros>

    <macros name="Master-AV-macros">
        <description>Macros for Master Audio- and Video</description>
        <macros name="Receivermacros">
            <description>Macros for setting volume to a preset value</description>
            <macro name="louder">
                <description>Turn up the volume slightly.</description>
                <command device="amp" command="volume_up" count="10"/>
            </macro>
            <macro name="quieter">
                <command device="amp" command="volume_down" count="10"/>
            </macro>
            <macro name="volume-loud">
                <description>Somewhat loud (-20 dB)</description>
                <command device="amp" command="set_volume">
                    <argument>60</argument>
                </command>
            </macro>
            <macro name="volume-normal">
                <description>-27 dB</description>
                <command device="amp" command="set_volume">
                    <argument>53</argument>
                </command>
            </macro>
            <macro name="volume-room">
                <description>-35 dB</description>
                <command device="amp" command="set_volume">
                    <argument>45</argument>
                </command>
            </macro>
            <macro name="volume-quiet">
                <description>-42 dB</description>
                <command device="amp" command="set_volume">
                    <argument>38</argument>
                </command>
            </macro>
            <macro name="volume-feeble">
                <description>Very quiet (-50 dB)</description>
                <command device="amp" command="set_volume">
                    <argument>30</argument>
                </command>
            </macro>
            <macro name="volume-faint">
                <description>Barely audible (-65 dB)</description>
                <command device="amp" command="set_volume">
                    <argument>15</argument>
                </command>
            </macro>
      
            <macro name="volume-standard">
                <description>"Standard" volume, whatever that means</description>
                <delay duration="1"/>
                <macrocall macro="volume-room"/>
            </macro>
      
            <macro name="desk-amp-on">
                <description>Turn on the desk amplifier</description>
                <command device="yamaha_desk" command="power_on"/>
            </macro>
      
            <macro name="desk-amp-off">
                <description>Turn on the desk amplifier</description>
                <command device="yamaha_desk" command="power_off"/>
            </macro>

            <macro name="volume-mute-on">
                <description>Master mute</description>
                <command device="amp" command="mute_on"/>
            </macro>

            <macro name="volume-mute-off">
                <description>Master mute</description>
                <command device="amp" command="mute_off"/>
            </macro>

            <macro visibility="private" name="assure-amp-on">
                <cond>
                    <clause>
                        <match regexp="PWSTANDBY">
                            <command device="amp" command="get_power"/>
                        </match>
                        <command device="amp" command="power_on"/>
                        <delay duration="5000"/>
                        <true/>
                    </clause>
                </cond>
            </macro>

            <macro visibility="private" name="assure-external-input">
                <cond>
                    <clause>
                        <match regexp="SDEXT.IN-1">
                            <command device="amp" command="get_input_mode"/>
                        </match>
                    </clause>
                    <clause>
                        <command device="amp" command="input_mode_ext_in"/>
                    </clause>
                </cond>
            </macro>

            <macro visibility="private" name="assure-hdmi-input">
                <cond>
                    <clause>
                        <match regexp="SDHDMI">
                            <command device="amp" command="get_input_mode"/>
                        </match>
                    </clause>
                    <clause>
                        <command device="amp" command="input_mode_hdmi"/>
                    </clause>
                </cond>
            </macro>


        </macros> <!-- receiver-macros -->
    </macros>

    <macros name="AV-output-macros">


        <macros name="projector-macros">
            <macro visibility="private" name="projector_ison">
                <description>Returns true if the projector is on</description>
                <match regexp="00|04">
                    <command device="projector" command="get_status"/>
                </match>
            </macro>

      <!-- Debugging -->
            <macro visibility="private" name="test4projector">
                <description>Investigates if the projector is on</description>
                <cond>
                    <clause>
                        <macrocall macro="projector_ison"/>
                        <message class="confirm">The projector is on!</message>
                    </clause>
                    <clause>
                        <true/>
                        <message class="confirm">The projector is NOT on!</message>
                    </clause>
                </cond>
            </macro>
        </macros>
    </macros>

    <macros name="AV-source-macros">

        <macros name="tunermacros">
            <description>Tuner</description>
            <macro name="listen-tuner">
                <description>Listen to the tuner</description>
                <command device="amp" command="in_tuner"/> <!-- toggles fm/am, grrr -->
                <command device="amp" command="fm"/>
            </macro>
        </macros>

        <macros name="DVD-macros">

            <macro name="dvd-ison" visibility="private">
	<!-- officially there is a get_power command, however, it does not work -->
                <command device="oppo" command="get_version"/> <!-- timesout if off -->
            </macro>

            <macro name="listen-dvd">
                <description>Listen to DVD.</description>
                <macrocall macro="assure-amp-on"/>
                <command device="dvd" command="power_on"/>
                <select-src device="main-receiver" src="dvd"/>
            </macro>

            <macro name="watch-dvd">
                <description>Watch to DVD on TV or projector.</description>
                <!--macrocall macro="tv-unless-projector"/-->
                <macrocall macro="listen-dvd"/>
                <command device="dvd" command="power_on"/>
                <select-src device="tv" src="denon" connectiontype="hdmi"/>
            </macro>

            <macro name="look-dvd">
                <description>Watch to DVD on TV, without sound.</description>
                <!--macrocall macro="tv-unless-projector"/-->
                <macrocall macro="assure-amp-on"/>
                <command device="dvd" command="power_on"/>
                <select-src device="main-receiver" src="dvd" mediatype="video_only"/>
            </macro>

            <macro name="watch-dvd-audio">
                <description>Sets up the system for DVD audio with 5.1 channels with support of back rear speakers. TV support.</description>
                <macrocall macro="listen-dvd-audio"/>
                <!--macrocall macro="tv-unless-projector"/-->
                <select-src device="tv" src="amp" connectiontype="hdmi"/>
	<!--set-variable name="Hometheatre.selectedDevice" value='"dvd"'/-->
            </macro>

            <macro name="listen-dvd-audio">
                <description>Sets up the system for DVD audio with 5.1 channels with support of back rear speakers. Leaves picture alone.</description>
                <macrocall macro="listen-dvd"/>
                <macrocall macro="assure-external-input"/>
                <command device="analog_8ch_switch" command="dvd_audio_bs"/>
	<!--set-variable name="Hometheatre.selectedDevice" value='"dvd"'/-->
            </macro>

            <macro name="pause-toggle-dvd">
                <description>Pause or unpause the dvd player</description>
                <command device="dvd" command="pause_toggle"/>
            </macro>

            <macro name="pause-off-dvd">
                <description>Unpause the dvd player</description>
                <command device="dvd" command="play"/>
            </macro>
      
            <macro name="pause-on-dvd">
                <description>pause the dvd player, safe but noisy version</description>
                <command device="dvd" command="play"/>
                <delay duration="1000"/>
                <command device="dvd" command="pause_toggle"/>
            </macro>

            <macro visibility="private" name="assure-dvd-open">
                <description>Makes up for the lack of a discrete open command</description>
                <cond>
                    <clause>
                        <match regexp="Opening">
                            <command device="dvd" command="get_disc_type"/>
                        </match>
                    </clause>
                    <clause>
                        <command device="dvd" command="open_close"/>
                    </clause>
                </cond>
            </macro>

            <macro visibility="private" name="assure-dvd-closed">
                <description>Makes up for the lack of a discrete open command</description>
                <cond>
                    <clause>
                        <match regexp="Opening">
                            <command device="dvd" command="get_disc_type"/>
                        </match>
                        <command device="dvd" command="open_close"/>
                    </clause>
                    <clause>
                        <true/>
                    </clause>
                </cond>
            </macro>

            <macro name="switch-dvd">
                <command device="dvd" command="power_on"/>
                <delay duration="10000"/>
                <macrocall macro="assure-dvd-open"/>
                <message>Now switch or remove the DVD within 60 seconds.</message>
                <delay duration="60000"/>
                <command device="dvd" command="open_close"/>
            </macro>
      
            <macro name="remove-dvd">
                <macrocall macro="switch-dvd"/>
                <command device="dvd" command="power_off"/>
            </macro>
      
            <macro name="play-another-dvd">
                <macrocall macro="switch-dvd"/>
                <command device="dvd" command="play"/>
                <macrocall macro="watch-dvd"/>
            </macro>

            <macro name="play-another-cd">
                <macrocall macro="switch-dvd"/>
                <command device="dvd" command="play"/>
                <macrocall macro="listen-dvd"/>
            </macro>
        </macros>

        <macros name="dBox-macros">

            <macro visibility="private" name="assure-dbox-on">
                <cond>
                    <clause>
                        <command device="dbox" command="ping"/>
                        <command device="dbox" command="standby_off"/>
                    </clause>
                    <clause>
                        <command device="dbox" command="power_on"/>
                    </clause>
                </cond>
            </macro>

            <macro visibility="private" name="setup-dbox-tv">
                <description>Use to encapsulate</description>
                <command device="dbox" command="aspectratio_automatic"/>
            </macro>

            <macro visibility="private" name="setup-dbox-projector">
                <description>Use to encapsulate</description>
                <command device="dbox" command="aspectratio_16_9"/>
            </macro>

            <macro visibility="private" name="setup-dbox-tv-or-projector">
                <description>Setup the dbox depending upon projector or TV is used</description>
                <cond>
                    <clause>
                        <macrocall macro="projector_ison"/>
                        <macrocall macro="setup-dbox-projector"/>
                    </clause>
                    <clause>
                        <macrocall macro="setup-dbox-tv"/>
                    </clause>
                </cond>
            </macro>

            <macro name="listen-dbox">
                <description>Sets up the system for dBox viewing on TV (just sound).</description>
                <macrocall macro="assure-amp-on"/>
                <select-src mediatype="audio_video" device="amp" src="dbox"/>
            </macro>

            <macro name="look-dbox">
                <description>Sets up the system for dBox viewing on TV, without sound.</description>
                <macrocall macro="assure-amp-on"/>
                <!--macrocall macro="tv-unless-projector"/-->
                <select-src mediatype="video_only" device="amp" src="dbox"/>
                <select-src connectiontype="yuv" device="tv" src="amp"/>
                <command device="dbox" command="standby_off"/>
                <macrocall macro="setup-dbox-tv-or-projector"/>
            </macro>

            <macro name="watch-dbox">
                <description>Sets up the system for dBox viewing on TV or projector.</description>
                <macrocall macro="assure-amp-on"/>
                <!--macrocall macro="tv-unless-projector"/-->
                <select-src mediatype="audio_video" device="amp" src="dbox"/>
                <select-src connectiontype="yuv" device="tv" src="amp"/>
                <command device="dbox" command="standby_off"/>
                <macrocall macro="setup-dbox-tv-or-projector"/>
	<!--set-variable name="Hometheatre.selectedDevice" value='"dbox"'/-->
            </macro>

            <macro name="disney">
                <description>Turn dBox to Disney Channel</description>
                <command device="dbox" command="set_program_by_name">
                    <argument>Disney Channel</argument>
                </command>
            </macro>
            <macro name="deluxe">
                <description>Turn dBox to Deluxe Music</description>
                <command device="dbox" command="set_program_by_name">
                    <argument>DELUXE MUSIC - CV</argument>
                </command>
            </macro>
            <macro name="prosieben">
                <description>Turn dBox to Pro Sieben</description>
                <command device="dbox" command="set_program_by_name">
                    <argument>ProSieben</argument>
                </command>
            </macro>
        </macros>
    
        <macros name="TV-macros">
            <macro name="watch-tv">
                <description>Turn on TV (not using projector)</description>
                <select-src device="amp" src="tv"/>
                <command device="tv" command="tv_mode"/> <!-- not working :-\ -->
	<!--set-variable name="Hometheatre.selectedDevice" value='"tv"'/-->
            </macro>

            <macro name="rtl-f1">
                <description>Display the RTL Formula 1 teletext pages</description>

                <!--macrocall macro="look-tv"/-->
                <command device="tv" command="cmd_4"/>
                <delay duration="5000"/>
                <command device="tv" command="teletext"/>
                <delay duration="1000"/>
                <command device="tv" command="cmd_2"/>
                <command device="tv" command="cmd_5"/>
                <command device="tv" command="cmd_0"/>
            </macro>
        </macros>

        <macros name="Popcorn-hour-macros">
            <macro name="poweroff-popcorn">
                <description>Shuts down the Popcorn hour</description>
                <command device="popcorn" command="power_toggle"/>
                <command device="popcorn" command="delete"/>
            </macro>
        </macros>
    </macros> <!-- AV sources -->

    <macros name="Powermacros">
        <description>Macros for turning on light, lowering blinds, etc</description>

        <macros name="Lightning">
            <description>Macros for dealing with light</description>
            <macro name="front-left-right-on">
                <description>Turn on halogen light front, left, and right</description>
                <command device="front_light" command="power_on"/>
                <command device="left_light" command="power_on"/>
                <command device="right_light" command="power_on"/>
            </macro>

            <macro name="front-left-right-off">
                <description>Turn off halogen light front, left, and right</description>
                <command device="front_light" command="power_off"/>
                <command device="left_light" command="power_off"/>
                <command device="right_light" command="power_off"/>
            </macro>

            <macro name="front-left-right-toggle">
                <description>Toggle halogen light front, left, and right</description>
                <command device="front_light" command="power_toggle"/>
                <command device="left_light" command="power_toggle"/>
                <command device="right_light" command="power_toggle"/>
            </macro>

            <macro name="floor-lamps-on">
                <description>Turn on all floor lamps</description>
                <command device="floor_lamp_1" command="power_on"/>
                <command device="floor_lamp_2" command="power_on"/>
                <command device="floor_lamp_3" command="power_on"/>
            </macro>

            <macro name="floor-lamps-off">
                <description>Turn off all floor lamps</description>
                <command device="floor_lamp_1" command="power_off"/>
                <command device="floor_lamp_2" command="power_off"/>
                <command device="floor_lamp_3" command="power_off"/>
            </macro>
        </macros>

        <macros name="Blinds">
            <description>Macros for raising and lowering blinds</description>
            <macro name="all-down">
                <description>Lowers all blinds, except bedroom.</description>
                <command device="large_blind" command="power_on"/>
                <command device="small_blind" command="power_on"/>
                <command device="balcony_blind" command="power_on"/>
                <command device="kitchen_blind" command="power_on"/>
            </macro>

            <macro name="all-up">
                <description>Raises all blinds, except bedroom.</description>
                <command device="large_blind" command="power_off"/>
                <command device="small_blind" command="power_off"/>
                <command device="balcony_blind" command="power_off"/>
                <command device="kitchen_blind" command="power_off"/>
            </macro>

            <macro name="all-down-smart">
                <description>...also inhibits the relay signal.</description>
                <macrocall macro="all-down"/>
                <macrocall macro="all-down"/>
            </macro>

            <macro name="all-up-smart">
                <description>...also inhibits the relay signal.</description>
                <macrocall macro="all-up"/>
                <macrocall macro="all-up"/>
            </macro>
        </macros>

        <macros name="Door-macros">
            <macro name="door_open">
                <description>Opens the balcony door, unless already open.</description>
                <cond>
                    <clause>
                        <match regexp="on">
                            <command device="balcony_door" command="get_state"/>
                        </match>
                        <command device="balcony_door" command="open_close"/>
                    </clause>
                    <clause>
                        <true/>
                    </clause>
                </cond>
            </macro>

            <macro name="door_close">
                <description>Closes the balcony door, unless already closed.</description>
                <cond>
                    <clause>
                        <match regexp="off">
                            <command device="balcony_door" command="get_state"/>
                        </match>
                        <command device="balcony_door" command="open_close"/>
                    </clause>
                    <clause>
                        <true/>
                    </clause>
                </cond>
            </macro>

            <macro name="balcony_open_close">
                <command device="balcony_door" command="open_close"/>
            </macro>
        </macros>

    </macros>



    <macros visibility="private" name="menu-macros">
        <menu name="Watch macros" id="watch" nuke-prefix="watch_">
            <description>Macros for turning the home theatre to selected device</description>
            <macrocall macro="watch-dvd"/>
            <macrocall macro="watch-dvd-audio"/>
            <macrocall macro="watch-dbox"/>
            <macrocall macro="watch-tv"/>
        </menu>

        <menu name="Listen macros" id="listen" nuke-prefix="listen_">
            <description>Macros for turning only the audio to selected device, leaving video alone if possible</description>
            <macrocall macro="listen-dvd"/>
            <macrocall macro="listen-dvd-audio"/>
            <macrocall macro="listen-dbox"/>
            <macrocall macro="listen-tuner"/>
        </menu>

        <menu name="Look macros" id="look" nuke-prefix="look_">
            <description>Macros for turning only the video to selected device, leaving audio alone if possible</description>
            <macrocall macro="look-dvd"/>
            <macrocall macro="look-dbox"/>
        </menu>

        <menu name="Volume macros" id="volume" nuke-prefix="volume_">
            <description>Macros for setting a preset volume</description>
            <macrocall macro="volume-loud"/>
            <macrocall macro="volume-normal"/>
            <macrocall macro="volume-room"/>
            <macrocall macro="volume-quiet"/>
            <macrocall macro="volume-feeble"/>
            <macrocall macro="volume-faint"/>
        </menu>
    </macros>
</macros>
